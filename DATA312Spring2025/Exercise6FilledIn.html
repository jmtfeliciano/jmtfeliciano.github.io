<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 6 - Hands on Exercise in Map Making and File Reading</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Exercise6FilledIn_files/libs/clipboard/clipboard.min.js"></script>
<script src="Exercise6FilledIn_files/libs/quarto-html/quarto.js"></script>
<script src="Exercise6FilledIn_files/libs/quarto-html/popper.min.js"></script>
<script src="Exercise6FilledIn_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Exercise6FilledIn_files/libs/quarto-html/anchor.min.js"></script>
<link href="Exercise6FilledIn_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Exercise6FilledIn_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Exercise6FilledIn_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Exercise6FilledIn_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Exercise6FilledIn_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 6 - Hands on Exercise in Map Making and File Reading</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="before-we-continue" class="level2">
<h2 class="anchored" data-anchor-id="before-we-continue">Before we continue</h2>
<p>This exercise quarto file will read a lot of csv files that you need to read into R so it is best to be organized.</p>
<p>Please see slides 9-11 of <a href="https://jmtfeliciano.github.io/DATA312Spring2025/Data312Spring2025_Lecture4#9" class="uri">https://jmtfeliciano.github.io/DATA312Spring2025/Data312Spring2025_Lecture4#9</a> if you need a refresher on file reading.</p>
<p>Some of the <code>read_csv()</code> uses the local path method taught in Lecture 4, so you will have to hard wire the full path if you don’t follow best practices.</p>
</section>
<section id="let-us-revisit-left_join-and-give-you-plenty-of-practice" class="level2">
<h2 class="anchored" data-anchor-id="let-us-revisit-left_join-and-give-you-plenty-of-practice">Let us revisit left_join and give you plenty of practice</h2>
<p>I previously shared the image below in slide 33 of Lecture 5 last week to visually show you how <code>left_join()</code> works. We use <code>left_join(data_frame1, dataframe2)</code> to merge data from another data frame (table) into another data frame (table). We typically want to save the joined data into a data frame in our R environment.</p>
<p>So what you’ll typically see is: <code>new_data_frame &lt;- left_join(data_frame1, dataframe2)</code></p>
<p><img src="https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/referencedimage/left_join_example.png" class="img-fluid" width="548"></p>
<p>There are many types of joins. But you may think of <code>new_data_frame &lt;- left_join(data_frame1, dataframe2)</code> as supplementing data from data_frame2 into the underlying data of data_frame1 then saves the joined data into the R environment as <code>new_data_frame.</code> To learn more about joins (e.g., other joins such as inner_join), you may see a detailed lecture on joins I gave lecture last semester for DATA 412/612 here: <a href="https://jmtfeliciano.github.io/DATA412Fall2024/Data412612Lecture7" class="uri">https://jmtfeliciano.github.io/DATA412Fall2024/Data412612Lecture7</a></p>
<p><strong>Important note:</strong> <code>new_data_frame &lt;- left_join(data_frame1, dataframe2)</code> only works if and only if they share a <strong>common variable</strong>. Moreover, the <strong>common variable</strong> must also be of the same type (e.g., both are chr or both are numeric/double/integer).</p>
</section>
<section id="preliminaries-part-1" class="level2">
<h2 class="anchored" data-anchor-id="preliminaries-part-1">Preliminaries Part 1</h2>
<p>Run the script below to load the tidyverse package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="practice-1-left_join---3-minutes" class="level2">
<h2 class="anchored" data-anchor-id="practice-1-left_join---3-minutes">Practice 1: left_join() - 3 minutes</h2>
<p><strong>Important Note Above Code Blow:</strong> You don’t have to know <code>tribble()</code>. Just know I am creating data frames (one named <code>comics_character</code>, the other <code>comics_publisher)</code> into the R environment below</p>
<p>Let us run this to create <code>comics_character</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>comics_character <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       <span class="sc">~</span>name, <span class="sc">~</span>alignment,  <span class="sc">~</span>gender, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"Magneto"</span>,      <span class="st">"bad"</span>,   <span class="st">"male"</span>,  </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Storm"</span>,     <span class="st">"good"</span>, <span class="st">"female"</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mystique"</span>,      <span class="st">"bad"</span>, <span class="st">"female"</span>,  </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Batman"</span>,     <span class="st">"good"</span>,   <span class="st">"male"</span>,   </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Joker"</span>,      <span class="st">"bad"</span>,   <span class="st">"male"</span>,   </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Catwoman"</span>,      <span class="st">"bad"</span>, <span class="st">"female"</span>,   </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>   <span class="st">"Hellboy"</span>,     <span class="st">"good"</span>,   <span class="st">"male"</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(comics_character, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  name     alignment gender
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt; 
1 Magneto  bad       male  
2 Storm    good      female
3 Mystique bad       female
4 Batman   good      male  
5 Joker    bad       male  
6 Catwoman bad       female
7 Hellboy  good      male  </code></pre>
</div>
</div>
<p>Let us run this to create <code>comics_publisher</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>comics_publisher <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="sc">~</span>name,         <span class="sc">~</span>publisher,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"Magneto"</span>,          <span class="st">"Marvel"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Storm"</span>,          <span class="st">"Marvel"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mystique"</span>,          <span class="st">"Marvel"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Batman"</span>,          <span class="st">"DC"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Joker"</span>,          <span class="st">"DC"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Catwoman"</span>,          <span class="st">"DC"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>   <span class="st">"Hellboy"</span>,          <span class="st">"Dark Horse Comics"</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(comics_publisher, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  name     publisher        
  &lt;chr&gt;    &lt;chr&gt;            
1 Magneto  Marvel           
2 Storm    Marvel           
3 Mystique Marvel           
4 Batman   DC               
5 Joker    DC               
6 Catwoman DC               
7 Hellboy  Dark Horse Comics</code></pre>
</div>
</div>
<p>Using the R chunk below, create <code>comics_character_v2</code> after pulling the publisher data from <code>comics_publisher</code> into the underlying data for <code>comics_character.</code> Afterward, use <code>head()</code> to visually confirm that <code>comics_character_v2</code> is created as expected <strong>Important note:</strong> Before typing your code below, visually confirm from the printed data frame data above that both data frames have (a) a shared variable with the same name and (b) that variable (also called the join key) has the same variable type in both data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Place your code below</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>comics_character_v2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(comics_character, comics_publisher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(comics_character_v2, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  name     alignment gender publisher        
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;            
1 Magneto  bad       male   Marvel           
2 Storm    good      female Marvel           
3 Mystique bad       female Marvel           
4 Batman   good      male   DC               
5 Joker    bad       male   DC               
6 Catwoman bad       female DC               
7 Hellboy  good      male   Dark Horse Comics</code></pre>
</div>
</div>
</section>
<section id="practice-2-left_join---3-minutes" class="level2">
<h2 class="anchored" data-anchor-id="practice-2-left_join---3-minutes">Practice 2: left_join() - 3 minutes</h2>
<p>Use the space below to load employees.csv and salaries.csv (both are under Week 6 on Canvas) using <code>read_csv()</code> into your R environment. Name these data frames however you want as long it follows best practice. Make sure to use <code>head()</code> for both data frames so you can study the underlying data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Place your code below</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>employees <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/employees.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): Name
dbl (2): EmployeeID, Age

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(employees)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  EmployeeID Name      Age
       &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
1        101 Alice      25
2        102 Bob        30
3        103 Charlie    35
4        104 David      40
5        105 Emma       28
6        106 Frank      33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>salaries <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/salaries.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): City
dbl (2): EmployeeID, Salary

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(salaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  EmployeeID City         Salary
       &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;
1        101 New York      60000
2        102 Los Angeles   65000
3        104 Chicago       70000
4        106 Houston       62000
5        107 Phoenix       67000
6        108 Philadelphia  68000</code></pre>
</div>
</div>
<p>Next, using <code>left_join()</code> to combine salary data into the employees data. Save the resulting data frame into your R environment and you may name it however you want as long the name follows best practice. <strong>Important note (again):</strong> Before typing your code below, visually confirm from the printed data frame data above that both data frames have (a) a shared variable with the same name and (b) that shared variable (also called the join key) has the same variable type in both data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now that we have confirmed join key is EmployeeID and they're the same type (dbl)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(employees, salaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(EmployeeID)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  EmployeeID Name      Age City        Salary
       &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
1        101 Alice      25 New York     60000
2        102 Bob        30 Los Angeles  65000
3        103 Charlie    35 &lt;NA&gt;            NA
4        104 David      40 Chicago      70000
5        105 Emma       28 &lt;NA&gt;            NA
6        106 Frank      33 Houston      62000</code></pre>
</div>
</div>
</section>
<section id="join-key-have-different-names" class="level2">
<h2 class="anchored" data-anchor-id="join-key-have-different-names">Join key have different names</h2>
<p>Suppose we want to <code>left_join()</code> two data frames called <code>data_frame1</code> and <code>data_frame2</code>. But the join key, let’s say is social security number, differs in spelling. How do you handle this? Before answering this, let us look at the data again for <code>employee_ssn</code> and <code>salaries_ssn</code> below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>employee_ssn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/employees_ssn.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): social_security_number, Name
dbl (1): Age

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>salaries_ssn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/salaries_ssn.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): ssn, City
dbl (1): Salary

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(employee_ssn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  social_security_number Name      Age
  &lt;chr&gt;                  &lt;chr&gt;   &lt;dbl&gt;
1 123-45-6789            Alice      25
2 234-56-7890            Bob        30
3 345-67-8901            Charlie    35
4 456-78-9012            David      40
5 567-89-0123            Emma       28
6 678-90-1234            Frank      33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(salaries_ssn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  ssn         City         Salary
  &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;
1 123-45-6789 New York      60000
2 234-56-7890 Los Angeles   65000
3 456-78-9012 Chicago       70000
4 678-90-1234 Houston       62000
5 789-01-2345 Phoenix       67000
6 890-12-3456 Philadelphia  68000</code></pre>
</div>
</div>
<p><strong>What error do you get when you have no common variable?</strong> Run the script below to see the error mesage:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(employee_ssn, salaries_ssn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `left_join()`:
! `by` must be supplied when `x` and `y` have no common variables.
ℹ Use `cross_join()` to perform a cross-join.</code></pre>
</div>
</div>
<p><strong>An easy remedy:</strong> pipe one of the <code>read_csv()</code> into <code>rename()</code> so both data frames have the same name for the appropriate key join.</p>
</section>
<section id="practice-3-3-mins" class="level2">
<h2 class="anchored" data-anchor-id="practice-3-3-mins">Practice 3 (3 mins)</h2>
<p><strong>Modify</strong> the code below by incorporating or piping one of the <code>read_csv()</code> statements into <code>rename()</code> to enable the <code>left_join()</code> below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BEFORE WE MADE CHANGES</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>employee_ssn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/employees_ssn.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ssn =</span> social_security_number)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>salaries_ssn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/salaries_ssn.csv"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(employee_ssn)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(salaries_ssn)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>employee_salary_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(employee_ssn, salaries_ssn)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(employee_salary_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AFTER WE MADE THE CHANGE</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>employee_ssn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/employees_ssn.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ssn =</span> social_security_number)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): social_security_number, Name
dbl (1): Age

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>salaries_ssn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/salaries_ssn.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): ssn, City
dbl (1): Salary

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(employee_ssn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  ssn         Name      Age
  &lt;chr&gt;       &lt;chr&gt;   &lt;dbl&gt;
1 123-45-6789 Alice      25
2 234-56-7890 Bob        30
3 345-67-8901 Charlie    35
4 456-78-9012 David      40
5 567-89-0123 Emma       28
6 678-90-1234 Frank      33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(salaries_ssn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  ssn         City         Salary
  &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;
1 123-45-6789 New York      60000
2 234-56-7890 Los Angeles   65000
3 456-78-9012 Chicago       70000
4 678-90-1234 Houston       62000
5 789-01-2345 Phoenix       67000
6 890-12-3456 Philadelphia  68000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>employee_salary_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(employee_ssn, salaries_ssn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(ssn)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(employee_salary_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  ssn         Name      Age City        Salary
  &lt;chr&gt;       &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
1 123-45-6789 Alice      25 New York     60000
2 234-56-7890 Bob        30 Los Angeles  65000
3 345-67-8901 Charlie    35 &lt;NA&gt;            NA
4 456-78-9012 David      40 Chicago      70000
5 567-89-0123 Emma       28 &lt;NA&gt;            NA
6 678-90-1234 Frank      33 Houston      62000</code></pre>
</div>
</div>
</section>
<section id="join-key-have-different-types" class="level2">
<h2 class="anchored" data-anchor-id="join-key-have-different-types">Join key have different types</h2>
<p>Before proceeding, run the following script which will will import two new data frames named <code>employee_ssn_v2</code> and <code>salaries_ssn_v2</code> into your R environment. Pay close attention to the social security number column and their data types for each data frame.</p>
<p><strong>Note:</strong> You don’t really have to know what <code>load()</code> does, just that I may ask you to run a similar code for a future class, homework, or exam which allows you to import multiple data frames at the same time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/jmtfeliciano/teachingdata/raw/refs/heads/main/salaries_data.RData"</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(employee_ssn_v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  social_security_number Name      Age
                   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
1              123456789 Alice      25
2              234567890 Bob        30
3              345678901 Charlie    35
4              456789012 David      40
5              567890123 Emma       28
6              678901234 Frank      33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(salaries_ssn_v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  social_security_number City         Salary
  &lt;chr&gt;                  &lt;chr&gt;         &lt;dbl&gt;
1 123456789              New York      60000
2 234567890              Los Angeles   65000
3 456789012              Chicago       70000
4 678901234              Houston       62000
5 789012345              Phoenix       67000
6 890123456              Philadelphia  68000</code></pre>
</div>
</div>
<p><strong>What error do you get when you have no common variable?</strong> Run the script below to see the error message:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(employee_ssn_v2, salaries_ssn_v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(social_security_number)`</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in `left_join()`:
! Can't join `x$social_security_number` with `y$social_security_number`
  due to incompatible types.
ℹ `x$social_security_number` is a &lt;double&gt;.
ℹ `y$social_security_number` is a &lt;character&gt;.</code></pre>
</div>
</div>
<p><strong>Again the issue:</strong> social_security_number in employee_ssn_v2 is double (which is numeric) while social_security_number in salaries_ssn_v2 is character or string.</p>
<p><strong>Two ways to fix this:</strong></p>
<p>(a) Create another data frame that we will use for the merging after forcing social_security_number from employee_ssn_v2 into character type by using:</p>
<p><code>|&gt;</code></p>
<p><code>mutate(social_security_number = as.character(social_security_number))</code> or</p>
<p>(b) Create another data frame that we will use for the merging after forcing social_security_number from salaries_ssn_v2 into numeric type by using:</p>
<p><code>|&gt; mutate(social_security_number = as.numeric(social_security_number))</code></p>
</section>
<section id="in-class-practice-together" class="level2">
<h2 class="anchored" data-anchor-id="in-class-practice-together">In class practice together</h2>
<p>Let us implement one of the fixes together as a class. Remember, <code>employee_ssn_v2</code> and <code>salaries_ssn_v2</code> exist already. And goal is to make <code>left_join()</code> eventually work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In class practice together</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>salaries_corrected <span class="ot">&lt;-</span> salaries_ssn_v2 <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">social_security_number =</span> <span class="fu">as.numeric</span>(social_security_number))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(employee_ssn_v2, salaries_corrected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(social_security_number)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  social_security_number Name      Age City        Salary
                   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
1              123456789 Alice      25 New York     60000
2              234567890 Bob        30 Los Angeles  65000
3              345678901 Charlie    35 &lt;NA&gt;            NA
4              456789012 David      40 Chicago      70000
5              567890123 Emma       28 &lt;NA&gt;            NA
6              678901234 Frank      33 Houston      62000</code></pre>
</div>
</div>
</section>
<section id="map-making-recipe-in-lecture-5" class="level2">
<h2 class="anchored" data-anchor-id="map-making-recipe-in-lecture-5"><strong>Map making recipe in Lecture 5</strong></h2>
<ol type="1">
<li><p>We need a <strong>shapefile file</strong> which is a digital format for storing geographic location and associated attribute information (e.g., points, lines, or polygons). Think of boundaries, shapes, geometric information to delineate locations and boundaries. We will use the <strong>tigris package</strong> to get the shapefiles directly from the US Census Bureau, so we don’t have to work and manually load actual shapefiles (.shp) into R. Shapefiles loaded into R from tigris are both sf (simple feature which is geospatial data in R) and data frames.</p></li>
<li><p>We need data to map we are interested in. For example, use <code>read_csv()</code> to read data you want to plot.</p></li>
<li><p>Merge data (e.g., SVI data) to the shapefile (which is also a data frame) via <code>left_join()</code>.</p>
<p><strong>Additional Note about the shapefile:</strong> The join key for the shapefile from the tigris package will always be GEOID of character (or string) type. If there is a mismatch on the join key (i.e., different spelling for join key, join key having different type), pipe the shapefile or <code>read_csv()</code> into (a) <code>rename()</code> or (b) <code>mutate()</code> with either as.character() or as.numeric(). If you are loading csv files into R, GEOID or FIPS will almost always be read as a numeric type into R, so either (i) convert GEOID from the shapefile into numeric type or (ii) convert GEOID from the file you read into character type.</p></li>
<li><p>Leverage ggplot2 package to render the map by using <code>geom_sf()</code>.</p></li>
</ol>
</section>
<section id="preliminaries-part-2" class="level2">
<h2 class="anchored" data-anchor-id="preliminaries-part-2">Preliminaries Part 2</h2>
<p>Run the script below to load the tigris package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>To enable caching of data, set `options(tigris_use_cache = TRUE)`
in your R script or .Rprofile.</code></pre>
</div>
</div>
</section>
<section id="map-1-census-tract-data-for-a-particular-state" class="level2">
<h2 class="anchored" data-anchor-id="map-1-census-tract-data-for-a-particular-state">Map 1: census tract data for a particular state</h2>
<p>Our goal for our first map is to create a map for the 2019 social vulnerability for MO.</p>
<p><strong>Step 1 of Map 1:</strong> use <code>tracts()</code> to get tract-level shapefile for the state of MO for 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>dc_tract_shp <span class="ot">&lt;-</span> <span class="fu">tracts</span>(<span class="at">year =</span> <span class="dv">2019</span>, <span class="at">state =</span> <span class="st">"MO"</span>) </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># important note: shapefile R objects don't show you variable/column data type via head() so you must use glimpse() for this</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dc_tract_shp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,393
Columns: 13
$ STATEFP  &lt;chr&gt; "29", "29", "29", "29", "29", "29", "29", "29", "29", "29", "…
$ COUNTYFP &lt;chr&gt; "055", "055", "055", "055", "015", "229", "229", "229", "229"…
$ TRACTCE  &lt;chr&gt; "450302", "450102", "450200", "450400", "460400", "490300", "…
$ GEOID    &lt;chr&gt; "29055450302", "29055450102", "29055450200", "29055450400", "…
$ NAME     &lt;chr&gt; "4503.02", "4501.02", "4502", "4504", "4604", "4903", "4904",…
$ NAMELSAD &lt;chr&gt; "Census Tract 4503.02", "Census Tract 4501.02", "Census Tract…
$ MTFCC    &lt;chr&gt; "G5020", "G5020", "G5020", "G5020", "G5020", "G5020", "G5020"…
$ FUNCSTAT &lt;chr&gt; "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "…
$ ALAND    &lt;dbl&gt; 59019556, 215515312, 785265618, 518540939, 216350354, 3354059…
$ AWATER   &lt;dbl&gt; 54839, 158937, 714683, 475755, 11553444, 257629, 136121, 1863…
$ INTPTLAT &lt;chr&gt; "+38.0699995", "+38.1505661", "+37.9120761", "+37.8958096", "…
$ INTPTLON &lt;chr&gt; "-091.3834407", "-091.1929142", "-091.2086380", "-091.3892205…
$ geometry &lt;POLYGON [°]&gt; POLYGON ((-91.42897 38.0501..., POLYGON ((-91.31192 3…</code></pre>
</div>
</div>
<p><strong>Step 2 of Map 1:</strong> read data you want to load into R. We eventually want to plot the values of <code>RPL_THEMES</code><strong>.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mo_svi_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/MissouriSVI2019.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1388 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): STATE, ST_ABBR, COUNTY, LOCATION
dbl (8): ST, STCNTY, FIPS, RPL_THEME1, RPL_THEME2, RPL_THEME3, RPL_THEME4, R...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mo_svi_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 12
     ST STATE    ST_ABBR STCNTY COUNTY       FIPS LOCATION RPL_THEME1 RPL_THEME2
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;
1    29 MISSOURI MO       29189 St. Louis 2.92e10 Census …     0.0123     0.067 
2    29 MISSOURI MO       29095 Jackson   2.91e10 Census …     0.0007     0.130 
3    29 MISSOURI MO       29095 Jackson   2.91e10 Census …     0.018      0.0252
4    29 MISSOURI MO       29095 Jackson   2.91e10 Census …     0          0.189 
5    29 MISSOURI MO       29189 St. Louis 2.92e10 Census …     0.0079     0.219 
6    29 MISSOURI MO       29095 Jackson   2.91e10 Census …     0.0346     0.0159
# ℹ 3 more variables: RPL_THEME3 &lt;dbl&gt;, RPL_THEME4 &lt;dbl&gt;, RPL_THEMES &lt;dbl&gt;</code></pre>
</div>
</div>
<p><strong>Step 3 of Map 1:</strong> use left_join() to add data you loaded in R into the shapefile. Modify dc_tract_shp and mo_svi_data to enable join. Note: In this example, we piped mo_svi_data into <code>rename(GEOID = FIPS)</code> because the join key in the shapefile is GEOID, so we renamed FIPS into GEOID within the mo_svi_data data for the to enable the join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># converts GEOID in the shapefile into numeric type instead of character</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>dc_tract_shp_corrected <span class="ot">&lt;-</span> dc_tract_shp <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># renames FIPS into GEOID to enable join</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>mo_svi_data_corrected <span class="ot">&lt;-</span> mo_svi_data <span class="sc">|&gt;</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GEOID =</span> FIPS) </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># perform join</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>dc_tract_shp_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dc_tract_shp_corrected, mo_svi_data_corrected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(GEOID)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize data</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dc_tract_shp_with_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,393
Columns: 24
$ STATEFP    &lt;chr&gt; "29", "29", "29", "29", "29", "29", "29", "29", "29", "29",…
$ COUNTYFP   &lt;chr&gt; "055", "055", "055", "055", "015", "229", "229", "229", "22…
$ TRACTCE    &lt;chr&gt; "450302", "450102", "450200", "450400", "460400", "490300",…
$ GEOID      &lt;dbl&gt; 29055450302, 29055450102, 29055450200, 29055450400, 2901546…
$ NAME       &lt;chr&gt; "4503.02", "4501.02", "4502", "4504", "4604", "4903", "4904…
$ NAMELSAD   &lt;chr&gt; "Census Tract 4503.02", "Census Tract 4501.02", "Census Tra…
$ MTFCC      &lt;chr&gt; "G5020", "G5020", "G5020", "G5020", "G5020", "G5020", "G502…
$ FUNCSTAT   &lt;chr&gt; "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S",…
$ ALAND      &lt;dbl&gt; 59019556, 215515312, 785265618, 518540939, 216350354, 33540…
$ AWATER     &lt;dbl&gt; 54839, 158937, 714683, 475755, 11553444, 257629, 136121, 18…
$ INTPTLAT   &lt;chr&gt; "+38.0699995", "+38.1505661", "+37.9120761", "+37.8958096",…
$ INTPTLON   &lt;chr&gt; "-091.3834407", "-091.1929142", "-091.2086380", "-091.38922…
$ ST         &lt;dbl&gt; 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29,…
$ STATE      &lt;chr&gt; "MISSOURI", "MISSOURI", "MISSOURI", "MISSOURI", "MISSOURI",…
$ ST_ABBR    &lt;chr&gt; "MO", "MO", "MO", "MO", "MO", "MO", "MO", "MO", "MO", "MO",…
$ STCNTY     &lt;dbl&gt; 29055, 29055, 29055, 29055, 29015, 29229, 29229, 29229, 292…
$ COUNTY     &lt;chr&gt; "Crawford", "Crawford", "Crawford", "Crawford", "Benton", "…
$ LOCATION   &lt;chr&gt; "Census Tract 4503.02, Crawford County, Missouri", "Census …
$ RPL_THEME1 &lt;dbl&gt; 0.9798, 0.7815, 0.9027, 0.7808, 0.9041, 0.8472, 0.8594, 0.7…
$ RPL_THEME2 &lt;dbl&gt; 0.9114, 0.9272, 0.3509, 0.9063, 0.5274, 0.9568, 0.9856, 0.6…
$ RPL_THEME3 &lt;dbl&gt; 0.6614, 0.3105, 0.0375, 0.0879, 0.0187, 0.0468, 0.4517, 0.0…
$ RPL_THEME4 &lt;dbl&gt; 0.8271, 0.7082, 0.5317, 0.6376, 0.2305, 0.8170, 0.8847, 0.3…
$ RPL_THEMES &lt;dbl&gt; 0.9690, 0.7952, 0.5537, 0.7123, 0.4852, 0.8147, 0.9466, 0.4…
$ geometry   &lt;POLYGON [°]&gt; POLYGON ((-91.42897 38.0501..., POLYGON ((-91.31192…</code></pre>
</div>
</div>
<p><strong>Step 4 of Map 1:</strong> use ggplot() to plot map. Again, we want to plot the values of <code>RPL_THEMES</code><strong>.</strong> Best to add <code>theme_bw()</code>, <code>theme_minimal()</code>, or <code>theme_void()</code> customization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dc_tract_shp_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> RPL_THEMES)) <span class="sc">+</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"white"</span>, <span class="at">high=</span><span class="st">"blue4"</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'MO-Specific SVI'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>A condense version of the code above where corrections are done via piping (preferred):</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save shapefile and makes GEOID numeric instead of character type</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>dc_tract_shp <span class="ot">&lt;-</span> <span class="fu">tracts</span>(<span class="at">year =</span> <span class="dv">2019</span>, <span class="at">state =</span> <span class="st">"MO"</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID))</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loads SVI data and rename FIPS into GEOID to enable join</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>mo_svi_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/jmtfeliciano/teachingdata/refs/heads/main/MissouriSVI2019.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GEOID =</span> FIPS) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1388 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): STATE, ST_ABBR, COUNTY, LOCATION
dbl (8): ST, STCNTY, FIPS, RPL_THEME1, RPL_THEME2, RPL_THEME3, RPL_THEME4, R...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform actual join</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>dc_tract_shp_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dc_tract_shp, mo_svi_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(GEOID)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dc_tract_shp_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> RPL_THEMES)) <span class="sc">+</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"white"</span>, <span class="at">high=</span><span class="st">"blue4"</span>) <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'MO-Specific SVI'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="practice-4-15-mins" class="level2">
<h2 class="anchored" data-anchor-id="practice-4-15-mins">Practice 4 (15 mins)</h2>
<p>For this class, your goal is to read <code>dc_household_income_2023.csv</code> and plot <strong>median_income</strong> which is the household median for income in DC for 2023. Use the R chunk below to create your map. You may additional R chunk as needed if desired or simply use the one space below to do all four steps of the map-making recipe. <strong>Reminder:</strong> When you load data via <code>read_csv()</code>, always check whether or not the join key is GEOID or called something else. You only need to pipe <code>read_csv()</code> into <code>rename()</code> if and only if the desired join key is not GEOID and is called something else. <strong>Also:</strong> please use another color gradient (don’t use white and blue4). Please see page 3 of <a href="https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf" class="uri">https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf</a> for available colors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Place your code below</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1:</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>dc_shapefile <span class="ot">&lt;-</span> <span class="fu">tracts</span>(<span class="at">year =</span> <span class="dv">2023</span>, <span class="at">state =</span> <span class="st">"DC"</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dc_shapefile)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2:</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>income_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/dc_household_income_2023.csv"</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(income_data)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>dc_shapefile_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dc_shapefile, income_data)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dc_shapefile_with_data)</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dc_shapefile_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> median_income)) <span class="sc">+</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"coral3"</span>, <span class="at">high =</span> <span class="st">"slategray1"</span>) <span class="sc">+</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Household Median</span><span class="sc">\n</span><span class="st">Income For DC 2023"</span>)</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a><span class="co"># \n tells R to bring the rest of the legend to the next line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 206
Columns: 14
$ STATEFP  &lt;chr&gt; "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "…
$ COUNTYFP &lt;chr&gt; "001", "001", "001", "001", "001", "001", "001", "001", "001"…
$ TRACTCE  &lt;chr&gt; "005302", "004402", "010602", "000804", "003902", "000903", "…
$ GEOID    &lt;dbl&gt; 11001005302, 11001004402, 11001010602, 11001000804, 110010039…
$ GEOIDFQ  &lt;chr&gt; "1400000US11001005302", "1400000US11001004402", "1400000US110…
$ NAME     &lt;chr&gt; "53.02", "44.02", "106.02", "8.04", "39.02", "9.03", "10.04",…
$ NAMELSAD &lt;chr&gt; "Census Tract 53.02", "Census Tract 44.02", "Census Tract 106…
$ MTFCC    &lt;chr&gt; "G5020", "G5020", "G5020", "G5020", "G5020", "G5020", "G5020"…
$ FUNCSTAT &lt;chr&gt; "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "…
$ ALAND    &lt;dbl&gt; 117635, 274746, 542512, 2566768, 266513, 928101, 1471925, 170…
$ AWATER   &lt;dbl&gt; 0, 0, 0, 167978, 11205, 0, 0, 516665, 0, 0, 5261, 0, 0, 0, 0,…
$ INTPTLAT &lt;chr&gt; "+38.9124517", "+38.9155152", "+38.9033936", "+38.9221746", "…
$ INTPTLON &lt;chr&gt; "-077.0386443", "-077.0270354", "-076.9994636", "-077.0918347…
$ geometry &lt;POLYGON [°]&gt; POLYGON ((-77.04167 38.9115..., POLYGON ((-77.03195 3…</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 201 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): variable
dbl (3): GEOID, median_income, moe

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
        GEOID variable   median_income   moe
        &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt;
1 11001000101 B19013_001        135708 43153
2 11001000102 B19013_001        159583 70430
3 11001000202 B19013_001        152059 60482
4 11001000300 B19013_001        174470 21374
5 11001000400 B19013_001        188929 71412
6 11001000501 B19013_001        109116 18172</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(GEOID)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 206
Columns: 17
$ STATEFP       &lt;chr&gt; "11", "11", "11", "11", "11", "11", "11", "11", "11", "1…
$ COUNTYFP      &lt;chr&gt; "001", "001", "001", "001", "001", "001", "001", "001", …
$ TRACTCE       &lt;chr&gt; "005302", "004402", "010602", "000804", "003902", "00090…
$ GEOID         &lt;dbl&gt; 11001005302, 11001004402, 11001010602, 11001000804, 1100…
$ GEOIDFQ       &lt;chr&gt; "1400000US11001005302", "1400000US11001004402", "1400000…
$ NAME          &lt;chr&gt; "53.02", "44.02", "106.02", "8.04", "39.02", "9.03", "10…
$ NAMELSAD      &lt;chr&gt; "Census Tract 53.02", "Census Tract 44.02", "Census Trac…
$ MTFCC         &lt;chr&gt; "G5020", "G5020", "G5020", "G5020", "G5020", "G5020", "G…
$ FUNCSTAT      &lt;chr&gt; "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "S", "…
$ ALAND         &lt;dbl&gt; 117635, 274746, 542512, 2566768, 266513, 928101, 1471925…
$ AWATER        &lt;dbl&gt; 0, 0, 0, 167978, 11205, 0, 0, 516665, 0, 0, 5261, 0, 0, …
$ INTPTLAT      &lt;chr&gt; "+38.9124517", "+38.9155152", "+38.9033936", "+38.922174…
$ INTPTLON      &lt;chr&gt; "-077.0386443", "-077.0270354", "-076.9994636", "-077.09…
$ variable      &lt;chr&gt; "B19013_001", "B19013_001", "B19013_001", "B19013_001", …
$ median_income &lt;dbl&gt; 138241, 177902, 175687, 250001, 114700, 250001, 222692, …
$ moe           &lt;dbl&gt; 33146, 35204, 21551, NA, 15081, NA, 46518, 70430, 41567,…
$ geometry      &lt;POLYGON [°]&gt; POLYGON ((-77.04167 38.9115..., POLYGON ((-77.03…</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="map-2-county-data-for-a-particular-state" class="level2">
<h2 class="anchored" data-anchor-id="map-2-county-data-for-a-particular-state">Map 2: county data for a particular state</h2>
<p>You need to follow the same recipe but this time, we use <code>counties(year = [year], state = "[state abbreviation]")</code> for the shape file.</p>
<p>Our goal for our first map is to create a county-level Virginia (VA) map for the county-level median household income using data from <code>va_household_income_2020.csv</code></p>
<p>This time, we need to plot <code>estimate</code>, which represents the county-level data median income for VA.</p>
<p><strong>Trying new (optional) customization this time:</strong> Let us add these new customization (a) add <code>labels = scales::comma</code> inside <code>scale_fill_gradient()</code> and (b) <code>+ theme(legend.position = c(0.2, 0.8))</code> at the bottom of the ggplot code then see what they do! Note: <code>theme(legend.position = c(0.2, 0.8))</code> shifts the legend from the lower left corner of the image by 0.20 ‘units’ to the right (think of x-axis in Math) and 0.8 ‘units’ higher Again, these are optional.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Load shapefile </span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: We can just pipe any corrections into mutate() directly</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>va_shapefile <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">year =</span> <span class="dv">2020</span>, <span class="at">state =</span> <span class="st">"VA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Load VA county-level household income for 2020. </span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>va_income_data2020 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/va_household_income_2020.csv"</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(va_income_data2020)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Perform the join</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>va_shapefile_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(va_shapefile, va_income_data2020)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Create the map</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(va_shapefile_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> estimate)) <span class="sc">+</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"white"</span>, <span class="at">high=</span><span class="st">"blue4"</span>, <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'VA Median Income'</span>) <span class="sc">+</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 133 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): variable
dbl (3): GEOID, estimate, moe

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  GEOID variable   estimate   moe
  &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;
1 51001 B19013_001    46178  2575
2 51003 B19013_001    84643  3217
3 51005 B19013_001    48513  4275
4 51007 B19013_001    63918  6276
5 51009 B19013_001    57368  4546
6 51011 B19013_001    55457  5246</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(GEOID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2
3.5.0.
ℹ Please use the `legend.position.inside` argument of `theme()` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pre-practice" class="level2">
<h2 class="anchored" data-anchor-id="pre-practice">Pre-practice</h2>
<p>Last week, we did a demo of the <strong>Small Area Health Insurance Estimates (SAHIE) dashboard</strong> where I quickly did a demo of downloading data from:</p>
<p>https://www.census.gov/data-tools/demo/sahie/#/</p>
<p>Let us quickly visit the website and download county-level data for Maryland (MD) for 2022.</p>
</section>
<section id="practice-5-10-mins" class="level2">
<h2 class="anchored" data-anchor-id="practice-5-10-mins">Practice 5 (10 mins)</h2>
<p><strong>Data pre-processing before R:</strong> After downloading the file into your computer, open the csv file in your computer and delete the first few rows until the row of variable names is the first row. Note: The uninsured rate is the column called <code>%</code> .</p>
<p>R <em>hates</em> symbols for column names (makes it difficult to work with in R), so before saving the file, rename % into something meaning (e.g., uninsured_rate). R also <em>hates</em> white spaces in column or variable names (again, makes it difficult to work with in R), so delete white spaces from column names. For Mac users, saving your file via <code>File &gt; Save</code> in Numbers (the default program for csv files in Mac) does not make a csv and actually creates what is called a Numbers spreadsheet, so you have to save the new csv file under <code>File &gt; Export To &gt; CSV</code></p>
<p>Use the R chunk below to do your work. Like always, you may add additional R chunk if desired. <strong>Also:</strong> please use another color gradient (don’t use white and blue4). Please see page 3 of <a href="https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf" class="uri">https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf</a> for available colors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Place your code below</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>md_shp <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">state =</span> <span class="st">"MD"</span>) <span class="sc">|&gt;</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID))</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>md_uninsured_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/SAHIE_02-18-2025.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GEOID =</span> ID)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>md_shp_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(md_shp, md_uninsured_data)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(md_shp_with_data )</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(md_shp_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> uninsured_rate)) <span class="sc">+</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() </span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co"># add customizations yourself later</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 25 Columns: 9
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(1): Name dbl (6): Year, ID, Margin of Error...5, uninsured_rate, % Margin of
Error, M... num (2): Number...4, Number...8
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Joining with `by = join_by(GEOID)`
• `Number` -&gt; `Number...4`
• `Margin of Error` -&gt; `Margin of Error...5`
• `Number` -&gt; `Number...8`
• `Margin of Error` -&gt; `Margin of Error...9`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 25 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -79.06756 ymin: 37.99421 xmax: -74.98628 ymax: 39.72304
Geodetic CRS:  NAD83
  STATEFP COUNTYFP COUNTYNS GEOID      NAME         NAMELSAD LSAD CLASSFP MTFCC
1      24      047 01668802 24047 Worcester Worcester County   06      H1 G4020
2      24      001 01713506 24001  Allegany  Allegany County   06      H1 G4020
3      24      510 01702381 24510 Baltimore   Baltimore city   25      C7 G4020
4      24      015 00596115 24015     Cecil     Cecil County   06      H1 G4020
5      24      005 01695314 24005 Baltimore Baltimore County   06      H1 G4020
6      24      013 01696228 24013   Carroll   Carroll County   06      H1 G4020
  CSAFP CBSAFP METDIVFP FUNCSTAT      ALAND    AWATER    INTPTLAT     INTPTLON
1  &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        A 1213156432 586531107 +38.2221332 -075.3099315
2  &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        A 1093489886  14710932 +39.6123134 -078.7031037
3  &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        F  209649330  28758743 +39.3000324 -076.6104761
4  &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        A  896912534 185281256 +39.5623537 -075.9415852
5  &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        A 1549740652 215957832 +39.4431666 -076.6165693
6  &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;        A 1159355858  13112464 +39.5633280 -077.0153297
  Year                 Name Number...4 Margin of Error...5 uninsured_rate
1 2022 Worcester County, MD       2686                 373            7.1
2 2022  Allegany County, MD       2960                 424            6.1
3 2022   Baltimore city, MD      30030                2908            6.6
4 2022     Cecil County, MD       4676                 603            5.4
5 2022 Baltimore County, MD      40013                3482            6.0
6 2022   Carroll County, MD       6130                 745            4.3
  % Margin of Error Number...8 Margin of Error...9
1               1.0      37991                   0
2               0.9      48441                   0
3               0.6     456931                   0
4               0.7      86661                   0
5               0.5     668068                   0
6               0.5     141937                   0
                        geometry
1 MULTIPOLYGON (((-75.07849 3...
2 MULTIPOLYGON (((-78.42042 3...
3 MULTIPOLYGON (((-76.71151 3...
4 MULTIPOLYGON (((-75.77209 3...
5 MULTIPOLYGON (((-76.69766 3...
6 MULTIPOLYGON (((-77.31156 3...</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="map-3-state-data-nationwide" class="level2">
<h2 class="anchored" data-anchor-id="map-3-state-data-nationwide">Map 3: state data nationwide</h2>
<p>Again, this follows the prescribed recipe but with added complications. This time, we need to use <code>states(year = [year])</code></p>
<p>Let us create the map using what we learned so far (but notice an issue with the plot):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Bad code'</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>nationwide_shapefile <span class="ot">&lt;-</span> <span class="fu">states</span>(<span class="at">year =</span> <span class="dv">2021</span>) </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>nationwide_income <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/nationwide_household_income_2021.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GEOID =</span> fips_code)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>nationwide_shp_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(nationwide_shapefile, nationwide_income)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nationwide_shp_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> estimate)) <span class="sc">+</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"white"</span>, <span class="at">high=</span><span class="st">"blue"</span>, <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'Household Income'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 52 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): fips_code, variable
dbl (2): estimate, moe

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Joining with `by = join_by(GEOID)`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When you are mapping the entire country, we typically scale then place Alaska, Hawaii, and Puerto Rico under the contiguous United States. We can do this in R by piping <code>state()</code> into <code>shift_geometry().</code> <code>shift_geometry()</code> only works for those three states/territories, but not for other territories such as Guam. Therefore, we need to remove them using <code>filter()</code></p>
<p><strong>Note:</strong> I am introducing the ! notation inside filter() so it is filtering for the opposite thing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Good code'</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>nationwide_shapefile <span class="ot">&lt;-</span> <span class="fu">states</span>(<span class="at">year =</span> <span class="dv">2021</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"American Samoa"</span>, </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Commonwealth of the Northern Mariana Islands"</span>, </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Guam"</span>, </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"United States Virgin Islands"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shift_geometry</span>()</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>nationwide_income <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/nationwide_household_income_2021.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GEOID =</span> fips_code)</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>nationwide_shp_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(nationwide_shapefile, nationwide_income)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nationwide_shp_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> estimate)) <span class="sc">+</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"white"</span>, <span class="at">high=</span><span class="st">"blue"</span>, <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'Median Household Income'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 52 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): fips_code, variable
dbl (2): estimate, moe

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Joining with `by = join_by(GEOID)`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="practice-6-10-mins" class="level2">
<h2 class="anchored" data-anchor-id="practice-6-10-mins">Practice 6 (10 mins)</h2>
<p>Plot data from <code>breast_cancer_state_mortality_2023.csv</code> to show the mortality rate for states across the US in 2023. The variable you is deaths_per_100000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="do">## WILL BE ASSIGNED FOR HOMEWORK</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-categorical-data-instead-of-numerical-data" class="level2">
<h2 class="anchored" data-anchor-id="plotting-categorical-data-instead-of-numerical-data">Plotting categorical data instead of numerical data</h2>
<p>Suppose we want to map to indicate where states have expanded Medicaid access for their citizens as of December 2023. Let us view the data below before plotting:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>nationwide2023 <span class="ot">&lt;-</span> <span class="fu">states</span>(<span class="at">year =</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GEOID =</span> <span class="fu">as.numeric</span>(GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"American Samoa"</span>, <span class="st">"Commonwealth of the Northern Mariana Islands"</span>, <span class="st">"Commonwealth of the Northern Mariana Islands"</span>, <span class="st">"Guam"</span>, <span class="st">"United States Virgin Islands"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shift_geometry</span>()</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>medicaid_expansion <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/medicaid_expansion.csv"</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(medicaid_expansion)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>nationwide2023_with_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(nationwide2023, medicaid_expansion)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nationwide2023_with_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 51 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): StateName, medicaid_expansion
dbl (1): GEOID

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  GEOID StateName  medicaid_expansion
  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;             
1     1 Alabama    Not Adopted       
2     2 Alaska     Adopted           
3     4 Arizona    Adopted           
4     5 Arkansas   Adopted           
5     6 California Adopted           
6     8 Colorado   Adopted           </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(GEOID)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 17 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -91843.51 ymin: -1354601 xmax: 2042471 ymax: 1323908
Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic
  REGION DIVISION STATEFP  STATENS GEOID     GEOIDFQ STUSPS          NAME LSAD
1      3        5      54 01779805    54 0400000US54     WV West Virginia   00
2      3        5      12 00294478    12 0400000US12     FL       Florida   00
3      2        3      17 01779784    17 0400000US17     IL      Illinois   00
4      2        4      27 00662849    27 0400000US27     MN     Minnesota   00
5      3        5      24 01714934    24 0400000US24     MD      Maryland   00
6      1        1      44 01219835    44 0400000US44     RI  Rhode Island   00
  MTFCC FUNCSTAT        ALAND      AWATER    INTPTLAT     INTPTLON
1 G4000        A  62266499712   489003081 +38.6472854 -080.6183274
2 G4000        A 138963763779 45970528648 +28.3989775 -082.5143005
3 G4000        A 143778366814  6216688589 +40.1028754 -089.1526108
4 G4000        A 206244555303 18937471947 +46.3159573 -094.1996043
5 G4000        A  25151736098  6979330958 +38.9466584 -076.6744939
6 G4000        A   2677763372  1323686976 +41.5964850 -071.5264901
      StateName medicaid_expansion                       geometry
1 West Virginia            Adopted MULTIPOLYGON (((1548777 354...
2       Florida        Not Adopted MULTIPOLYGON (((1318717 -13...
3      Illinois            Adopted MULTIPOLYGON (((701650.5 11...
4     Minnesota            Adopted MULTIPOLYGON (((50386.4 128...
5      Maryland            Adopted MULTIPOLYGON (((1718035 379...
6  Rhode Island            Adopted MULTIPOLYGON (((2002871 667...</code></pre>
</div>
</div>
<p><strong>Important note for plotting categorical data:</strong> Do not use <code>scale_fill_gradient()</code> as we have been doing since that is for plotting numerical values. Let us plot our image before customizing our map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nationwide2023_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> medicaid_expansion)) <span class="sc">+</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'Median Household Income'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>How do you customize color?</strong> First determine how many unique values you have (e.g., using distinct()) and use <code>scale_fill_manual(values = c([your colors here))</code> In the case of medicaid expansion, there are only two options. In this example, let us use <code>scale_fill_manual(values = c("cornflowerblue", "darkslategrey"))</code> where we specify two colors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nationwide2023_with_data,</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">fill =</span> medicaid_expansion)) <span class="sc">+</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"darkslategrey"</span>)) <span class="sc">+</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'Medicaid Expansion</span><span class="sc">\n</span><span class="st">As of Dec 2023'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ONE BRIEF </span><span class="al">NOTE</span><span class="co">: within labs(), I used \n.</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># \n tells R you want the rest on the next line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note:</strong> if the lack of data for Puerto Rico is bothersome to you, feel free to add “Puerto Rico” inside <code>filter(!NAME %in% c([list here])).</code> You might have to do this often because often, national data sets exclude Puerto Rico.</p>
</section>
<section id="practice-7-10-mins" class="level2">
<h2 class="anchored" data-anchor-id="practice-7-10-mins">Practice 7 (10 mins)</h2>
<p>Plot data from <code>presidential_election1964.csv</code> to plot which states won by Barry Goldwater vs Lyndon B. Johnson in the 1964 election. <code>Victor</code> is the variable you’d want to plot here. <strong>Note:</strong> the map of states hasn’t really changed since 1959 when Hawaii because the 50th state. Also, <code>states(year = 1964)</code> will not work since it does not exist in the API where tigris pulls the data from, please use any year for the state map in this practice (e.g., <code>states(year = 2020)</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">## WILL BE ASSIGNED FOR HOMEWORK</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="package-for-dark-mode-images-ggdark" class="level2">
<h2 class="anchored" data-anchor-id="package-for-dark-mode-images-ggdark">Package for ‘Dark Mode’ images: ggdark</h2>
<p>You may use the ggdark package as demonstrated below. This works for all ggplot (not just maps).</p>
<p>Instead of using theme_minimal() or theme_void(), you need to use dark_theme_minimal() or dark_theme_void().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run install.packages("ggdark") in console if not installed</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdark)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nationwide2023_with_data, <span class="fu">aes</span>(<span class="at">fill =</span> medicaid_expansion)) <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">'Medicaid Expansion</span><span class="sc">\n</span><span class="st">As of Dec 2023'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Inverted geom defaults of fill and color/colour.
To change them back, use invert_geom_defaults().</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Exercise6FilledIn_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rest-of-the-class" class="level2">
<h2 class="anchored" data-anchor-id="rest-of-the-class">Rest of the class</h2>
<p>Finish going over Lecture 5 slides from slide 44:</p>
<p><a href="https://jmtfeliciano.github.io/DATA312Spring2025/Data312Spring2025_Lecture5#44" class="uri">https://jmtfeliciano.github.io/DATA312Spring2025/Data312Spring2025_Lecture5#44</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>